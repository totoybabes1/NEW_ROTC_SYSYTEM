{% extends 'admin/base.html' %}
{% load static %}
{% load personnel_tags %}

{% block title %}Personnel & Flight Groups{% endblock %}

{% block content %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();
</script>

<div class="container-fluid mt-4">
    <!-- Page Header Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body p-5">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="bg-primary bg-opacity-25 rounded-circle p-4">
                                <i class="fa-solid fa-users-line text-primary fa-3x fw-bold"></i>
                            </div>
                        </div>
                        <div class="col">
                            <h1 class="display-4 mb-0 fw-bolder">Personnel & Flight Groups</h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="row g-3">
        <!-- Action Center Card -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white p-3 border-bottom">
                    <div class="accordion" id="actionCenterAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button p-0 bg-transparent" type="button" data-bs-toggle="collapse" data-bs-target="#actionCenterContent">
                                    <div class="d-flex align-items-center">
                                        <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                            <i class="fa-solid fa-compass text-primary fa-lg"></i>
                                        </div>
                                        <div>
                                            <h5 class="mb-1">Action & Search Center</h5>
                                            <p class="text-muted mb-0 small">Your all-in-one command post for searching personnel records, performing quick actions, and managing team operations. Use the search tools to find specific members or groups, and access essential management functions to coordinate your personnel efficiently.</p>
                                        </div>
                                    </div>
                                </button>
                            </h2>
                            <div id="actionCenterContent" class="accordion-collapse collapse show">
                                <div class="card-body p-3">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="input-group mb-3">
                                                <span class="input-group-text bg-transparent">
                                                    <i class="fas fa-search"></i>
                                                </span>
                                                <input type="text" 
                                                       id="searchInput" 
                                                       class="form-control" 
                                                       placeholder="Search personnel...">
                                            </div>

                                            <div class="input-group mb-3">
                                                <span class="input-group-text bg-transparent">
                                                    <i class="fas fa-sort"></i>
                                                </span>
                                                <select id="sortSelect" class="form-select">
                                                    <option value="name_asc">Name (A-Z)</option>
                                                    <option value="name_desc">Name (Z-A)</option>
                                                    <option value="position_asc">Position (A-Z)</option>
                                                    <option value="position_desc">Position (Z-A)</option>
                                                </select>

                                                <span class="input-group-text bg-transparent">
                                                    <i class="fas fa-filter"></i>
                                                </span>
                                                <select class="form-select">
                                                    <option value="">All Status</option>
                                                    <option value="active">Active</option>
                                                    <option value="inactive">Inactive</option>
                                                </select>
                                            </div>
                                            
                                            <div class="d-flex flex-wrap gap-2">
                                                <button class="btn btn-primary position-relative py-2 px-3" data-bs-toggle="modal" data-bs-target="#addPersonnelModal">
                                                    <div class="d-flex align-items-center">
                                                        <div class="rounded-circle bg-white bg-opacity-25 p-1 me-2">
                                                            <i class="fas fa-plus-circle text-white"></i>
                                                        </div>
                                                        <div class="text-start">
                                                            <small class="d-block text-white-50">Add</small>
                                                            <span class="fw-bold">Add New Personnel</span>
                                                        </div>
                                                    </div>
                                                </button>
                                                
                                                <button class="btn btn-primary position-relative py-2 px-3" data-bs-toggle="modal" data-bs-target="#addFlightGroupModal">
                                                    <div class="d-flex align-items-center">
                                                        <div class="rounded-circle bg-white bg-opacity-25 p-1 me-2">
                                                            <i class="fas fa-layer-group text-white"></i>
                                                        </div>
                                                        <div class="text-start">
                                                            <small class="d-block text-white-50">Create</small>
                                                            <span class="fw-bold">Create Flight Group</span>
                                                        </div>
                                                    </div>
                                                </button>
                                                
                                                <a href="{% url 'assign_gender' %}" class="btn btn-primary position-relative py-2 px-3">
                                                    <div class="d-flex align-items-center">
                                                        <div class="rounded-circle bg-white bg-opacity-25 p-1 me-2">
                                                            <i class="fas fa-users-cog text-white"></i>
                                                        </div>
                                                        <div class="text-start">
                                                            <small class="d-block text-white-50">Assign</small>
                                                            <span class="fw-bold">Assign Gender to Personnel</span>
                                                        </div>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simple Bootstrap Tab Navigation -->
        <div class="col-12">
            <div class="card shadow-sm">
                <!-- Enhanced Tab Navigation -->
                <div class="card-header bg-white p-0 border-bottom">
                    <ul class="nav nav-tabs nav-fill border-0" id="personnelTabs">
                        <li class="nav-item">
                            <a class="nav-link active py-3 px-4" id="personnel-tab" data-bs-toggle="tab" href="#personnel-content">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                        <i class="fas fa-users text-primary fa-lg"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0 fs-4">Personnel List</h6>
                                        <small class="text-muted fs-6">Manage all personnel</small>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-3 px-4" id="flight-groups-tab" data-bs-toggle="tab" href="#flight-groups-content">
                                <div class="d-flex align-items-center justify-content-center">
                                    <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                        <i class="fas fa-layer-group text-primary fa-lg"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0 fs-4">Flight Groups</h6>
                                        <small class="text-muted fs-6">Manage flight groups</small>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Tab Content -->
                <div class="tab-content" id="personnelTabsContent">
                    <!-- Personnel Tab Content -->
                    <div class="tab-pane fade show active" id="personnel-content" role="tabpanel">
                        <div class="row g-0">
                            <div class="col-12">
                                <!-- Messages -->
                                {% if messages %}
                                    {% for message in messages %}
                                        <div class="alert alert-info alert-dismissible fade show m-3">
                                            {{ message }}
                                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                        </div>
                                    {% endfor %}
                                {% endif %}

                                <!-- Personnel Table Card -->
                                <div class="card shadow-sm m-3">
                                    <div class="card-header bg-white py-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0 fs-4">
                                                <i class="fas fa-users text-primary me-2"></i>
                                                Personnel List
                                            </h5>
                                            <span class="badge bg-primary fs-6">{{ personnel|length }} Total</span>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0" id="personnelTable">
                                                <thead>
                                                    <tr class="bg-light">
                                                        <th class="d-none d-md-table-cell border-0 px-4 py-3" style="width: 60px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Profile</div>
                                                        </th>
                                                        <th class="border-0 px-4 py-3" style="width: 200px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Name</div>
                                                        </th>
                                                        <th class="d-none d-md-table-cell border-0 px-4 py-3" style="width: 120px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Student ID</div>
                                                        </th>
                                                        <th class="d-none d-md-table-cell border-0 px-4 py-3" style="width: 150px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Position</div>
                                                        </th>
                                                        <th class="border-0 px-4 py-3" style="width: 100px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Status</div>
                                                        </th>
                                                        <th class="d-none d-lg-table-cell border-0 px-4 py-3" style="width: 120px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Flight Group</div>
                                                        </th>
                                                        <th class="d-none d-lg-table-cell border-0 px-4 py-3" style="width: 120px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Contact</div>
                                                        </th>
                                                        <th class="d-none d-lg-table-cell border-0 px-4 py-3" style="width: 140px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Gender Assignment</div>
                                                        </th>
                                                        <th class="border-0 px-4 py-3" style="width: 200px;">
                                                            <div class="text-uppercase text-muted fw-bold fs-6">Actions</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody class="border-top-0">
                                                    {% for person in personnel %}
                                                    <tr>
                                                        <td class="d-none d-md-table-cell px-4">
                                                            <div class="position-relative">
                                                                {% if person.profile_picture %}
                                                                    <img src="{{ person.profile_picture.url }}" 
                                                                         class="rounded-circle border shadow-sm" 
                                                                         alt="Profile Picture"
                                                                         width="48" height="48"
                                                                         style="object-fit: cover;"
                                                                         data-bs-toggle="modal" 
                                                                         data-bs-target="#imageModal{{ person.id }}">
                                                                {% else %}
                                                                    <img src="{% static 'images/default-profile.png' %}" 
                                                                         class="rounded-circle border shadow-sm" 
                                                                         alt="Default Profile"
                                                                         width="48" height="48"
                                                                         style="object-fit: cover;"
                                                                         data-bs-toggle="modal" 
                                                                         data-bs-target="#imageModal{{ person.id }}">
                                                                {% endif %}
                                                            </div>
                                                        </td>
                                                        <td class="px-4">
                                                            <div>
                                                                <div class="fw-semibold text-dark fs-5">{{ person.first_name }} {{ person.last_name }}</div>
                                                                <div class="text-muted fs-6">@{{ person.user.username }}</div>
                                                                <!-- Mobile-only info -->
                                                                <div class="d-md-none text-muted fs-6 mt-1">
                                                                    <div><i class="fas fa-briefcase me-1"></i>{{ person.position }}</div>
                                                                    <div><i class="fas fa-id-card me-1"></i>{{ person.student_id }}</div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="d-none d-md-table-cell px-4">
                                                            <span class="badge bg-light text-dark border fs-6">{{ person.student_id }}</span>
                                                        </td>
                                                        <td class="d-none d-md-table-cell px-4">
                                                            <span class="text-muted fs-6">{{ person.position }}</span>
                                                        </td>
                                                        <td class="px-4">
                                                            <span class="badge {% if person.status == 'Active' %}bg-success-subtle text-success{% else %}bg-warning-subtle text-warning{% endif %} px-3 py-2 fs-6">
                                                                <i class="fas fa-circle me-1" style="font-size: 8px;"></i>{{ person.status }}
                                                            </span>
                                                        </td>
                                                        <td class="d-none d-lg-table-cell px-4">
                                                            {% if person.flight_group %}
                                                                <span class="badge bg-primary-subtle text-primary px-3 py-2 fs-6">{{ person.flight_group.name }}</span>
                                                            {% else %}
                                                                <span class="badge bg-secondary-subtle text-secondary px-3 py-2 fs-6">None</span>
                                                            {% endif %}
                                                        </td>
                                                        <td class="d-none d-lg-table-cell px-4">
                                                            <span class="text-muted fs-6">{{ person.phone_number }}</span>
                                                        </td>
                                                        <td class="d-none d-lg-table-cell px-4">
                                                            <span class="badge {% if person.gender_assignment %}bg-info-subtle text-info{% else %}bg-secondary-subtle text-secondary{% endif %} px-3 py-2 fs-6">
                                                                {{ person.gender_assignment|default:"Not Assigned" }}
                                                            </span>
                                                        </td>
                                                        <td class="px-4">
                                                            <div class="btn-group">
                                                                <button class="btn btn-outline-primary px-3 py-2" data-bs-toggle="modal" 
                                                                        data-bs-target="#viewPersonnelModal{{ person.id }}">
                                                                    <i class="fas fa-eye me-2"></i>View
                                                                </button>
                                                                <button class="btn btn-outline-success px-3 py-2" data-bs-toggle="modal" 
                                                                        data-bs-target="#editPersonnelModal{{ person.id }}">
                                                                    <i class="fas fa-edit me-2"></i>Edit
                                                                </button>
                                                                <button class="btn btn-outline-danger px-3 py-2" data-bs-toggle="modal" 
                                                                        data-bs-target="#deletePersonnelModal{{ person.id }}">
                                                                    <i class="fas fa-trash me-2"></i>Delete
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Flight Groups Tab Content -->
                    <div class="tab-pane fade" id="flight-groups-content" role="tabpanel">
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>Flight Groups</h5>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addFlightGroupModal">
                                    <i class="fas fa-plus"></i> Add Flight Group
                                </button>
                            </div>
                            
                            <div class="row g-3">
                                {% for group in flight_groups %}
                                <div class="col-md-4 col-lg-3">
                                    <div class="card h-100 shadow-sm">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ group.name }}</h5>
                                            <p class="card-text small text-muted">{{ group.description|truncatechars:100 }}</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="badge bg-info">{{ group.id|get_flight_group_members }} members</span>
                                                <div>
                                                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editFlightGroupModal{{ group.id }}">
                                                        <i class="fas fa-edit me-2"></i>Edit
                                                    </button>
                                                    <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteFlightGroupModal{{ group.id }}">
                                                        <i class="fas fa-trash me-2"></i>Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="col-12">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i> No flight groups have been created yet. Click "Add Flight Group" to create one.
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Personnel Modal -->
<div class="modal fade" id="addPersonnelModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add Personnel</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'add_personnel' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Username</label>
                            <input type="text" name="username" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-key"></i> Password</label>
                            <input type="password" name="password" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> First Name</label>
                            <input type="text" name="first_name" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Last Name</label>
                            <input type="text" name="last_name" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-briefcase"></i> Position</label>
                            <input type="text" name="position" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-info-circle"></i> Status</label>
                            <select name="status" class="form-control form-control-sm" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-id-card"></i> Student ID</label>
                            <input type="text" name="student_id" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-birthday-cake"></i> Age</label>
                            <input type="number" name="age" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-venus-mars"></i> Gender</label>
                            <select name="gender" class="form-control form-control-sm" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-phone"></i> Phone Number</label>
                            <input type="text" name="phone_number" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-users"></i> Flight Group</label>
                            <select name="flight_group" class="form-control form-control-sm">
                                <option value="">None</option>
                                {% for group in flight_groups %}
                                    <option value="{{ group.id }}">{{ group.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-image"></i> Profile Picture</label>
                            <input type="file" name="profile_picture" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-sm btn-primary">Add Personnel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS and dependencies -->
<script src="{% static 'js/personnel_list.js' %}"></script>

<!-- Add this for no results message -->
<div class="no-results" style="display: none;">
    <i class="fas fa-search"></i>
    <p>No personnel found matching your search.</p>
</div>

<!-- Image Preview Modal -->
{% for person in personnel %}
<div class="modal fade" id="imageModal{{ person.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">{{ person.first_name }} {{ person.last_name }}'s Profile Picture</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-0">
                {% if person.profile_picture %}
                    <img src="{{ person.profile_picture.url }}" 
                         class="img-fluid profile-preview" 
                         alt="Profile Picture">
                {% else %}
                    <img src="{% static 'images/default-profile.png' %}" 
                         class="img-fluid profile-preview" 
                         alt="Default Profile">
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Delete Confirmation Modal -->
{% for person in personnel %}
<div class="modal fade" id="deletePersonnelModal{{ person.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle text-danger"></i> Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong>{{ person.first_name }} {{ person.last_name }}</strong>?</p>
                <p class="text-muted small">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'delete_personnel' person.id %}" class="btn btn-sm btn-danger">
                    <i class="fas fa-trash"></i> Delete Personnel
                </a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add back the Edit and View Personnel Modals -->
{% for person in personnel %}
<!-- Edit Personnel Modal -->
<div class="modal fade" id="editPersonnelModal{{ person.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Personnel</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'edit_personnel' person.id %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Username</label>
                            <input type="text" name="username" class="form-control form-control-sm" 
                                   value="{{ person.user.username }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-key"></i> Password</label>
                            <input type="password" name="password" class="form-control form-control-sm" 
                                   placeholder="Leave blank to keep current password">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> First Name</label>
                            <input type="text" name="first_name" class="form-control form-control-sm" 
                                   value="{{ person.first_name }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Last Name</label>
                            <input type="text" name="last_name" class="form-control form-control-sm" 
                                   value="{{ person.last_name }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-briefcase"></i> Position</label>
                            <input type="text" name="position" class="form-control form-control-sm" 
                                   value="{{ person.position }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-info-circle"></i> Status</label>
                            <select name="status" class="form-control form-control-sm" required>
                                <option value="Active" {% if person.status == 'Active' %}selected{% endif %}>Active</option>
                                <option value="Inactive" {% if person.status == 'Inactive' %}selected{% endif %}>Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-id-card"></i> Student ID</label>
                            <input type="text" name="student_id" class="form-control form-control-sm" 
                                   value="{{ person.student_id }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-birthday-cake"></i> Age</label>
                            <input type="number" name="age" class="form-control form-control-sm" 
                                   value="{{ person.age }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-venus-mars"></i> Gender</label>
                            <select name="gender" class="form-control form-control-sm" required>
                                <option value="Male" {% if person.gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if person.gender == 'Female' %}selected{% endif %}>Female</option>
                                <option value="Other" {% if person.gender == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-phone"></i> Phone Number</label>
                            <input type="text" name="phone_number" class="form-control form-control-sm" 
                                   value="{{ person.phone_number }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-users"></i> Flight Group</label>
                            <select name="flight_group" class="form-control form-control-sm">
                                <option value="">None</option>
                                {% for group in flight_groups %}
                                    <option value="{{ group.id }}" 
                                        {% if person.flight_group.id == group.id %}selected{% endif %}>
                                        {{ group.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-image"></i> Profile Picture</label>
                            <input type="file" name="profile_picture" class="form-control form-control-sm">
                            {% if person.profile_picture %}
                                <small class="text-muted">Current: {{ person.profile_picture.name }}</small>
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-sm btn-primary">Update Personnel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- View Personnel Modal -->
<div class="modal fade" id="viewPersonnelModal{{ person.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border-0 bg-light">
                <h5 class="modal-title"><i class="fas fa-user"></i> Personnel Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-3">
                <!-- Profile Header -->
                <div class="text-center mb-3">
                    {% if person.profile_picture %}
                        <img src="{{ person.profile_picture.url }}" 
                             class="rounded-circle shadow-sm" 
                             style="width: 80px; height: 80px; object-fit: cover;"
                             alt="Profile Picture">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                             class="rounded-circle shadow-sm" 
                             style="width: 80px; height: 80px; object-fit: cover;"
                             alt="Default Profile">
                    {% endif %}
                    <h5 class="mt-2 mb-0">{{ person.first_name }} {{ person.last_name }}</h5>
                    <p class="text-muted small">@{{ person.user.username }}</p>
                </div>

                <!-- Info Cards -->
                <div class="row g-2">
                    <!-- Basic Info Card -->
                    <div class="col-12">
                        <div class="card border-0 shadow-sm mb-2">
                            <div class="card-body p-3">
                                <h6 class="mb-2"><i class="fas fa-user-circle me-2"></i>Basic Information</h6>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Position</label>
                                        <span>{{ person.position }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Status</label>
                                        <span class="badge bg-{% if person.status == 'Active' %}success{% else %}warning{% endif %}">
                                            {{ person.status }}
                                        </span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Student ID</label>
                                        <span>{{ person.student_id }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Age</label>
                                        <span>{{ person.age }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Info Card -->
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-3">
                                <h6 class="mb-2"><i class="fas fa-info-circle me-2"></i>Additional Information</h6>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Gender</label>
                                        <span>{{ person.gender }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Phone Number</label>
                                        <span>{{ person.phone_number }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Flight Group</label>
                                        {% if person.flight_group %}
                                            <span>{{ person.flight_group.name }}</span>
                                        {% else %}
                                            <span class="text-muted">None</span>
                                        {% endif %}
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Gender Assignment</label>
                                        <span>{{ person.gender_assignment|default:"Not Assigned" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add Flight Group Modal -->
<div class="modal fade" id="addFlightGroupModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add Flight Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'admin_flight_groups' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Flight Group
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Flight Group Modals -->
{% for group in flight_groups %}
<div class="modal fade" id="editFlightGroupModal{{ group.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Flight Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'edit_flight_group' group.id %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" name="name" class="form-control" value="{{ group.name }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea name="description" class="form-control" rows="3">{{ group.description }}</textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Flight Group
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Flight Group Modal -->
<div class="modal fade" id="deleteFlightGroupModal{{ group.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-trash text-danger"></i> Delete Flight Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the flight group <strong>{{ group.name }}</strong>?</p>
                <p class="text-danger">This action cannot be undone. Personnel in this group will no longer be assigned to any group.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'delete_flight_group' group.id %}" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete Flight Group
                </a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<style>
    #personnelTabs .nav-link {
        border: none;
        position: relative;
        transition: all 0.3s ease;
    }

    #personnelTabs .nav-link:hover {
        background-color: rgba(13, 110, 253, 0.05);
    }

    #personnelTabs .nav-link.active {
        border: none;
        background-color: transparent;
    }

    #personnelTabs .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background-color: #0d6efd;
        border-radius: 3px 3px 0 0;
    }

    #personnelTabs .nav-link:not(.active) {
        color: #6c757d;
    }

    @media (max-width: 768px) {
        #personnelTabs .nav-link {
            padding: 1rem 0.5rem;
        }
        
        #personnelTabs small {
            display: none;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Your existing personnel list JavaScript code...
    });
</script>
{% endblock %}