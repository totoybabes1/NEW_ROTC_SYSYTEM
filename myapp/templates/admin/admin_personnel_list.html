{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Personnel List{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/admin_personnel_list.css' %}">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();
</script>

<div class="container-fluid mt-4">
    <!-- Page Header Card -->
    <div class="row mb-4" data-aos="fade-up">
        <div class="col-12">
            <div class="card border-0 bg-white shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-3">
                                <i class="fa-solid fa-users-line text-primary fa-2x"></i>
                            </div>
                        </div>
                        <div class="col">
                            <h1 class="h3 mb-2">Personnel List</h1>
                            <p class="text-muted mb-0">
                                View, manage, and keep track of all personnel records in one place.  
                                Easily add new members, update existing information, and ensure accurate record-keeping.  
                                Maintain an organized database to streamline personnel management and improve efficiency.
                              </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Row -->
    <div class="row mb-3" data-aos="fade-up">
        <div class="col-md-4">
            <div class="card border-0 bg-white shadow-sm" style="border-radius: 8px;">
                <div class="quick-actions">
                    <h6>Quick Actions</h6>
                    <p class="text-muted small mb-3">Quickly add new personnel or assign gender to existing members</p>
                    <div class="quick-actions-container">
                        <button class="btn-add-personnel" data-bs-toggle="modal" data-bs-target="#addPersonnelModal">
                            <i class="fas fa-plus"></i>
                            <span>Add Personnel</span>
                        </button>
                        <a href="{% url 'assign_gender' %}" class="btn-assign-gender">
                            <i class="fas fa-users"></i>
                            <span>Assign Gender</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="row h-100">
                <!-- Total Personnel Card -->
                <div class="col-md-4">
                    <div class="card border-0 rounded-3 shadow-sm mb-4 stats-card-with-bg personnel-card h-100" data-aos="fade-up" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);">
                        <div class="card-body p-3 text-white">
                            <h6 class="mb-1 text-white text-center">Total Personnel</h6>
                            <div class="personnel-icon-container">
                                <div class="rounded-circle bg-black bg-opacity-25 p-3">
                                    <img src="{% static 'img/users.svg' %}" alt="Users Icon" style="width: 32px; height: 32px; filter: brightness(0) invert(1) opacity(0.9);">
                                </div>
                            </div>
                            <div class="total-personnel-display">
                                <h3 id="totalPersonnel" class="display-4 fw-bold mb-0">{{ personnel.count }}</h3>
                            </div>
                            <div class="text-white-50 small text-center">Active members in system</div>
                        </div>
                    </div>
                </div>

                <!-- Active Personnel Card -->
                <div class="col-md-4">
                    <div class="card border-0 rounded-3 shadow-sm mb-4 stats-card-with-bg active-personnel-card h-100" data-aos="fade-up" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="card-body p-3 text-white">
                            <h6 class="mb-1 text-white text-center">Active Personnel</h6>
                            <div class="personnel-icon-container">
                                <div class="rounded-circle bg-black bg-opacity-25 p-3">
                                    <img src="{% static 'img/user-check.svg' %}" alt="Users Icon" style="width: 32px; height: 32px; filter: brightness(0) invert(1) opacity(0.9);">
                                </div>
                            </div>
                            <div class="total-personnel-display">
                                <h3 class="display-4 fw-bold mb-0">{{ active_count }}</h3>
                            </div>
                            <div class="text-white-50 small text-center">Currently active members</div>
                        </div>
                    </div>
                </div>

                <!-- Personnel by Gender Card -->
                <div class="col-md-4">
                    <div class="card border-0 rounded-3 shadow-sm mb-4 stats-card-with-bg gender-distribution-card h-100" data-aos="fade-up" style="background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);">
                        <div class="card-body p-3 text-white">
                            <h6 class="mb-1 text-white text-center">Gender Distribution</h6>
                            <div class="personnel-icon-container">
                                <div class="rounded-circle bg-black bg-opacity-25 p-3">
                                    <i class="fas fa-venus-mars fa-2x" style="color: rgba(255,255,255,0.9);"></i>
                                </div>
                            </div>
                            <div class="d-flex justify-content-around mt-2">
                                <div class="text-center">
                                    <h4 class="display-4 fw-bold mb-0">{{ male_count }}</h4>
                                    <small class="text-white-50">Male</small>
                                </div>
                                <div class="text-center">
                                    <h4 class="display-4 fw-bold mb-0">{{ female_count }}</h4>
                                    <small class="text-white-50">Female</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header with Search -->
    <!-- Search and Filter Section - Allows users to search, sort and filter personnel records -->
    <div class="row mb-4" data-aos="fade-up">
        <div class="col-12">
            <div class="card border-0 bg-white shadow-sm">
                <div class="card-body p-4">
                    
                    <!-- Advanced Search and Filters -->
                    <div class="search-filters mb-0">
                        <p class="text-muted mb-3">Use the search, sort and filter options below to find specific personnel records.</p>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="search-box">
                                    <div class="input-group">
                                        <span class="input-group-text border-0">
                                            <i class="fas fa-search"></i>
                                        </span>
                                        <input type="text" 
                                               id="searchInput" 
                                               class="form-control border-0" 
                                               placeholder="Search personnel...">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="sort-box">
                                    <div class="input-group">
                                        <span class="input-group-text border-0">
                                            <i class="fas fa-sort"></i>
                                        </span>
                                        <select id="sortSelect" class="form-select border-0">
                                            <option value="name_asc">Name (A-Z)</option>
                                            <option value="name_desc">Name (Z-A)</option>
                                            <option value="position_asc">Position (A-Z)</option>
                                            <option value="position_desc">Position (Z-A)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="status-filter">
                                    <div class="input-group">
                                        <span class="input-group-text border-0">
                                            <i class="fas fa-filter"></i>
                                        </span>
                                        <select class="form-select border-0">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Main Content -->
    <div class="row g-4">
        <!-- Table Section -->
        <div class="col-lg-9" data-aos="fade-up">
            <!-- Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-info alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Bulk Actions -->
            <div class="bulk-actions mb-3" style="display: none;">
                <button id="bulkDeleteBtn" class="btn btn-danger btn-sm">
                    <i class="fas fa-trash"></i> Delete Selected (<span id="selectedCount">0</span>)
                </button>
            </div>

            <!-- Personnel Table Card -->
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="personnelTable">
                            <thead class="bg-light">
                                <tr>
                                    <th style="width: 30px;">
                                        <input type="checkbox" id="selectAll" class="form-check-input">
                                    </th>
                                    <th class="d-none d-md-table-cell" style="width: 50px;">Profile</th>
                                    <th>Name</th>
                                    <th class="d-none d-md-table-cell">Student ID</th>
                                    <th class="d-none d-md-table-cell">Position</th>
                                    <th>Status</th>
                                    <th class="d-none d-lg-table-cell">Flight Group</th>
                                    <th class="d-none d-lg-table-cell">Contact</th>
                                    <th class="d-none d-lg-table-cell">Gender Assignment</th>
                                    <th style="width: 150px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for person in personnel %}
                                <tr>
                                    <td>
                                        <input type="checkbox" class="form-check-input personnel-checkbox" 
                                               value="{{ person.id }}">
                                    </td>
                                    <td class="d-none d-md-table-cell">
                                        {% if person.profile_picture %}
                                            <img src="{{ person.profile_picture.url }}" 
                                                 class="rounded-circle profile-img cursor-pointer" 
                                                 alt="Profile Picture"
                                                 data-bs-toggle="modal" 
                                                 data-bs-target="#imageModal{{ person.id }}">
                                        {% else %}
                                            <img src="{% static 'images/default-profile.png' %}" 
                                                 class="rounded-circle profile-img cursor-pointer" 
                                                 alt="Default Profile"
                                                 data-bs-toggle="modal" 
                                                 data-bs-target="#imageModal{{ person.id }}">
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="d-flex flex-column">
                                            <span class="fw-bold">{{ person.first_name }} {{ person.last_name }}</span>
                                            <small class="text-muted">@{{ person.user.username }}</small>
                                            <!-- Mobile-only info -->
                                            <div class="d-md-none">
                                                <small class="text-muted">{{ person.position }}</small>
                                                <small class="text-muted d-block">ID: {{ person.student_id }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="d-none d-md-table-cell">{{ person.student_id }}</td>
                                    <td class="d-none d-md-table-cell">{{ person.position }}</td>
                                    <td>
                                        <span class="badge bg-{% if person.status == 'Active' %}success{% else %}warning{% endif %}">
                                            {{ person.status }}
                                        </span>
                                    </td>
                                    <td class="d-none d-lg-table-cell">
                                        {% if person.flight_group %}
                                            {{ person.flight_group.name }}
                                        {% else %}
                                            <span class="text-muted">None</span>
                                        {% endif %}
                                    </td>
                                    <td class="d-none d-lg-table-cell">{{ person.phone_number }}</td>
                                    <td class="d-none d-lg-table-cell">{{ person.gender_assignment|default:"Not Assigned" }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-view" data-bs-toggle="modal" 
                                                    data-bs-target="#viewPersonnelModal{{ person.id }}">
                                                <i class="fas fa-eye"></i><span class="d-none d-md-inline"> View</span>
                                            </button>
                                            <button class="btn btn-sm btn-outline-edit" data-bs-toggle="modal" 
                                                    data-bs-target="#editPersonnelModal{{ person.id }}">
                                                <i class="fas fa-edit"></i><span class="d-none d-md-inline"> Edit</span>
                                            </button>
                                            <button class="btn btn-sm btn-outline-delete" data-bs-toggle="modal" 
                                                    data-bs-target="#deletePersonnelModal{{ person.id }}">
                                                <i class="fas fa-trash"></i><span class="d-none d-md-inline"> Delete</span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="col-lg-3">
        
            <!-- Statistics card -->
            <div class="card border-0 bg-white shadow-sm mb-4" data-aos="fade-up">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="fw-semibold mb-0">Overview</h6>
                        <button class="btn btn-sm btn-outline-primary" id="zoomChartBtn">
                            <i class="fas fa-search-plus"></i>
                        </button>
                    </div>
                    <div class="chart-container" style="position: relative; height: 200px;">
                        <canvas id="personnelChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card border-0 bg-white shadow-sm" data-aos="fade-up">
                <div class="card-body p-3">
                    <h6 class="fw-semibold mb-3">Quick Stats</h6>
                    <div class="quick-stat mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">Active Personnel</span>
                            <span class="badge bg-success" id="activePercentage">0%</span>
                        </div>
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar bg-success" id="activeProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="quick-stat mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">Assigned Groups</span>
                            <span class="badge bg-primary" id="assignedPercentage">0%</span>
                        </div>
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar bg-primary" id="assignedProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Personnel Modal -->
<div class="modal fade" id="addPersonnelModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> Add Personnel</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'add_personnel' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Username</label>
                            <input type="text" name="username" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-key"></i> Password</label>
                            <input type="password" name="password" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> First Name</label>
                            <input type="text" name="first_name" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Last Name</label>
                            <input type="text" name="last_name" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-briefcase"></i> Position</label>
                            <input type="text" name="position" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-info-circle"></i> Status</label>
                            <select name="status" class="form-control form-control-sm" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-id-card"></i> Student ID</label>
                            <input type="text" name="student_id" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-birthday-cake"></i> Age</label>
                            <input type="number" name="age" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-venus-mars"></i> Gender</label>
                            <select name="gender" class="form-control form-control-sm" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-phone"></i> Phone Number</label>
                            <input type="text" name="phone_number" class="form-control form-control-sm" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-users"></i> Flight Group</label>
                            <select name="flight_group" class="form-control form-control-sm">
                                <option value="">None</option>
                                {% for group in flight_groups %}
                                    <option value="{{ group.id }}">{{ group.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-image"></i> Profile Picture</label>
                            <input type="file" name="profile_picture" class="form-control form-control-sm">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-sm btn-primary">Add Personnel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Include Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/personnel_list.js' %}"></script>

<!-- Add this for no results message -->
<div class="no-results" style="display: none;">
    <i class="fas fa-search"></i>
    <p>No personnel found matching your search.</p>
</div>

<!-- Image Preview Modal -->
{% for person in personnel %}
<div class="modal fade" id="imageModal{{ person.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">{{ person.first_name }} {{ person.last_name }}'s Profile Picture</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center p-0">
                {% if person.profile_picture %}
                    <img src="{{ person.profile_picture.url }}" 
                         class="img-fluid profile-preview" 
                         alt="Profile Picture">
                {% else %}
                    <img src="{% static 'images/default-profile.png' %}" 
                         class="img-fluid profile-preview" 
                         alt="Default Profile">
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Delete Confirmation Modal -->
{% for person in personnel %}
<div class="modal fade" id="deletePersonnelModal{{ person.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle text-danger"></i> Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong>{{ person.first_name }} {{ person.last_name }}</strong>?</p>
                <p class="text-muted small">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'delete_personnel' person.id %}" class="btn btn-sm btn-danger">
                    <i class="fas fa-trash"></i> Delete Personnel
                </a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Add this new modal for bulk delete confirmation -->
<div class="modal fade" id="bulkDeleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-danger"></i> 
                    Confirm Bulk Delete
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <span id="deleteCount">0</span> selected personnel?</p>
                <p class="text-danger">This action cannot be undone!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmBulkDelete">
                    <i class="fas fa-trash"></i> Delete Selected
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Add this modal for the zoomed chart -->
<div class="modal fade" id="chartZoomModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title">Personnel Distribution</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="zoomed-chart-container" style="position: relative; height: 400px;">
                    <canvas id="zoomedPersonnelChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add back the Edit and View Personnel Modals -->
{% for person in personnel %}
<!-- Edit Personnel Modal -->
<div class="modal fade" id="editPersonnelModal{{ person.id }}" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit"></i> Edit Personnel</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'edit_personnel' person.id %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Username</label>
                            <input type="text" name="username" class="form-control form-control-sm" 
                                   value="{{ person.user.username }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-key"></i> Password</label>
                            <input type="password" name="password" class="form-control form-control-sm" 
                                   placeholder="Leave blank to keep current password">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> First Name</label>
                            <input type="text" name="first_name" class="form-control form-control-sm" 
                                   value="{{ person.first_name }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user"></i> Last Name</label>
                            <input type="text" name="last_name" class="form-control form-control-sm" 
                                   value="{{ person.last_name }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-briefcase"></i> Position</label>
                            <input type="text" name="position" class="form-control form-control-sm" 
                                   value="{{ person.position }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-info-circle"></i> Status</label>
                            <select name="status" class="form-control form-control-sm" required>
                                <option value="Active" {% if person.status == 'Active' %}selected{% endif %}>Active</option>
                                <option value="Inactive" {% if person.status == 'Inactive' %}selected{% endif %}>Inactive</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-id-card"></i> Student ID</label>
                            <input type="text" name="student_id" class="form-control form-control-sm" 
                                   value="{{ person.student_id }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-birthday-cake"></i> Age</label>
                            <input type="number" name="age" class="form-control form-control-sm" 
                                   value="{{ person.age }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-venus-mars"></i> Gender</label>
                            <select name="gender" class="form-control form-control-sm" required>
                                <option value="Male" {% if person.gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if person.gender == 'Female' %}selected{% endif %}>Female</option>
                                <option value="Other" {% if person.gender == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-phone"></i> Phone Number</label>
                            <input type="text" name="phone_number" class="form-control form-control-sm" 
                                   value="{{ person.phone_number }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-users"></i> Flight Group</label>
                            <select name="flight_group" class="form-control form-control-sm">
                                <option value="">None</option>
                                {% for group in flight_groups %}
                                    <option value="{{ group.id }}" 
                                        {% if person.flight_group.id == group.id %}selected{% endif %}>
                                        {{ group.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-image"></i> Profile Picture</label>
                            <input type="file" name="profile_picture" class="form-control form-control-sm">
                            {% if person.profile_picture %}
                                <small class="text-muted">Current: {{ person.profile_picture.name }}</small>
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-sm btn-primary">Update Personnel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- View Personnel Modal -->
<div class="modal fade" id="viewPersonnelModal{{ person.id }}" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header border-0 bg-light">
                <h5 class="modal-title"><i class="fas fa-user"></i> Personnel Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-3">
                <!-- Profile Header -->
                <div class="text-center mb-3">
                    {% if person.profile_picture %}
                        <img src="{{ person.profile_picture.url }}" 
                             class="rounded-circle shadow-sm" 
                             style="width: 80px; height: 80px; object-fit: cover;"
                             alt="Profile Picture">
                    {% else %}
                        <img src="{% static 'images/default-profile.png' %}" 
                             class="rounded-circle shadow-sm" 
                             style="width: 80px; height: 80px; object-fit: cover;"
                             alt="Default Profile">
                    {% endif %}
                    <h5 class="mt-2 mb-0">{{ person.first_name }} {{ person.last_name }}</h5>
                    <p class="text-muted small">@{{ person.user.username }}</p>
                </div>

                <!-- Info Cards -->
                <div class="row g-2">
                    <!-- Basic Info Card -->
                    <div class="col-12">
                        <div class="card border-0 shadow-sm mb-2">
                            <div class="card-body p-3">
                                <h6 class="mb-2"><i class="fas fa-user-circle me-2"></i>Basic Information</h6>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Position</label>
                                        <span>{{ person.position }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Status</label>
                                        <span class="badge bg-{% if person.status == 'Active' %}success{% else %}warning{% endif %}">
                                            {{ person.status }}
                                        </span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Student ID</label>
                                        <span>{{ person.student_id }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Age</label>
                                        <span>{{ person.age }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Info Card -->
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-3">
                                <h6 class="mb-2"><i class="fas fa-info-circle me-2"></i>Additional Information</h6>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Gender</label>
                                        <span>{{ person.gender }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Phone Number</label>
                                        <span>{{ person.phone_number }}</span>
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Flight Group</label>
                                        {% if person.flight_group %}
                                            <span>{{ person.flight_group.name }}</span>
                                        {% else %}
                                            <span class="text-muted">None</span>
                                        {% endif %}
                                    </div>
                                    <div class="col-6">
                                        <label class="text-muted small d-block">Gender Assignment</label>
                                        <span>{{ person.gender_assignment|default:"Not Assigned" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Your existing personnel list JavaScript code...
    });
</script>
{% endblock %}